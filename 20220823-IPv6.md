# タイトル
## 概要
- 実験日: 2022/08/23
- CCNA第10章相当 IPv6

## 1. 概要
IPv6は枯渇が予想されるIPv4の後継として設計された。  
IPv4は32ビットであるために$2^{32}$乗個のアドレスしか利用できないが、IPv6は128ビットであるため$2^{128}$乗個という膨大な量のアドレスを利用できる。

### 1.1. IPv6の特徴
IPv6には以下のような特徴がある。
- DHCPサーバを利用せずにIPアドレスを自動設定できる
- ブロードキャストアドレスを廃止し、マルチキャストアドレスを利用してより柔軟なパケット伝送を行える
- IPv4と比較してパケットヘッダが簡略化されており、ルータへの負荷が減少する

### 1.2. IPv6アドレスの構造
エンドユーザにおいてはIPv6アドレスの128ビットのうち前半64ビットがサブネットプレフィックス、後半64ビットがインターフェースIDであり、前者がネットワーク部であり後者がホストを示す。  
IPv6アドレスは階層化されて管理されているためネットワーク部の長さはインターネットレジストリやISPなど、IPアドレスを扱う立場によって異なって解釈される。

### 1.3. IPv6アドレスの表現
IPv6アドレスは16進数で表して4桁ずつコロンで区切って表現する。  
```
IPv6アドレスの例
2000:1234:0000:00AB:CDEF:0010:0000:0000/64
```
IPv6アドレスはIPv4アドレスと比較して長くなってしまうことから省略することができる。
- それぞれのフィールドで先頭に入る0を省略できる
- 0000が複数のフィールドで連続する場合は一番長く連続する箇所かつ、より先頭に近い部分を一回のみ省略できる

上の例に省略ルールを適用すると以下のように表せる。
```
IPv6アドレスの例（省略形）
2000:1234:0:AB:CDEF:10::/64
```

### 1.4. インターフェースIDの決め方
IPv6アドレスの後半64ビットは手動設定かMACアドレスを利用したEUI-64形式で自動設定する方法がある。  
EUI-64形式では以下のような手順で生成される。
1. MACアドレスを24ビットごとで前後に分割する
2. 中央に`FFFE`を挿入する
3. 先頭から7ビット目をビット反転させる

なお、MACアドレスによってインターフェースIDを決定するEUI-64形式は、PCの物理構成に依存していることからユーザのトラッキングに利用される恐れがあるため、通常はランダム生成したインターフェースIDを用いる。

### 1.5. IPv6アドレスの種類
IPv6アドレスは大きく以下の3つに分類できる。
- ユニキャストアドレス
- マルチキャストアドレス
- エニーキャストアドレス

1. ユニキャストアドレス  
ユニキャストアドレスは1対1の通信で利用されるアドレスである。  
ユニキャストアドレスはさらに以下の5つに分類できる。

- グローバルユニキャストアドレス  
インターネット上で一意なアドレス  
現在IANAは最初の3ビットが001で始まるアドレスを割り振っており`2000::/3`のアドレスとなっている。

- リンクローカルユニキャストアドレス  
同一リンク間で利用されるアドレス  
アドレスブロックは`FE80::/10`  
このアドレスが利用されているパケットはルータを越えて通信することができない

- ユニークローカルユニキャストアドレス  
プライベート用のIPアドレス
このアドレスはグローバルIPv6アドレスネットワーク上でルーティングされない
アドレスブロックは`FC00::/7`であるが`FC00::/8`はIANAによって予約済みであるため、実質的に利用できるのは`FD00::/8`となる  
RFCで規定されている方法で生成する場合においては、**おおよそ**一意なアドレスとなる

- サイトローカルユニキャストアドレス  
サイト内で利用できるアドレスとして設計されていたが「サイト」の定義があいまいであり混乱を招くことから、上述のユニークローカルアドレスが規定されたのちに**廃止された**  
アドレスブロックは`FEC0::/8`

- 特殊ユニキャストアドレス  
未指定アドレス: 全ビットが0となる`::`で表記するものでDHCPv6サーバからアドレスを払いだす際に利用される  
ループバックアドレス: 自分自身を表すアドレスで`::1`と表記する  
IPv4射影アドレス: 先頭80ビットが0でそのあとの16ビットが1、残りの32ビットがIPv4アドレスで構成される

2. マルチキャストアドレス  
マルチキャストアドレスはある特定のノードのグループに対してパケットを送信する際に利用される。  
アドレスブロックは`FF00::/8`  
一部のマルチキャストアドレスはIANAによって予約されており代表的なものは以下のとおりである。  
>`FF02::1`: 全てのノード  
>`FF02::2`: 全てのルータ  
>`FF02::5`: 全てのOSPFルータ  
>`FF02::6`: 全てのOSPF DR, BDR

3. エニーキャストアドレス  
ネットワーク上で離れた複数のノードで1つのエニーキャストを共有するような構成になり、このアドレスを指定すると送信者に経路的に最も近いノードにのみ到達できる。