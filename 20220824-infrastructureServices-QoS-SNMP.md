# QoS､SNMP

## 概要
- 実験日: 2022/07/24
- CCNA第 11章 その他のインフラストラクチャサービスと運用

---
## 1 QoSのまとめ

* QoSとは､パケットに優先番号を付加することで遅延などのサービス品質を優先的に転送するプロトコル

* QoSの種類
  * ベストエフォート
    * 最大限の通信速度をするために､パケットの優先順位を決めずに送信する処理 
  * IntServ
    * IntServとは､帯域を確保することで品質を保つことができる技術の1つ
    * IntServのデメリット:各ルータが帯域を確保するという情報を保持し続けなければならない
  * DiffServ
    * DiffServとは､パケットに設定している優先度に従い優先的に転送する技術の1つ
    * DiffServのデメリット:IntServと比較して､帯域を確保しないため通信速度を保証することができない
 
<br><br>

* DiffServの分類
  * CoS
    * L2レベルでの優先度を表すもの
    * 図1よりPCP(CoS)タイプを利用して､3bitの中に優先度を示す情報が入る
    * 3bitの中に入る情報は､0~7の値を表示でき8種類の優先度を格納することが可能
      !["CoSパケットフレームの中身"](./images/20220824-infrastructureServicesImg/20220824-infrastructureServices_4.jpeg)
      図1､EthernetFlameの情報
  * DSCP
    * L3レベルでの優先度を表すもの
    * IPヘッダ内のサービスタイプを利用する
    * TOS内の8ビット中の6ビットを使用して､前半3ビットは優先度を後半3ビットは破棄レベルを表す｡
    * DSCPパケット内容の特徴
      * 前半3ビットの値が大きければ優先度が高い
      * 後半3ビットの値が大きければ破棄されやすい

* 信頼境界
  * 信頼する区間と信頼しない区間を区別する
  * 信頼境界はなぜ必要なのか
    * 動画再生が遅い場合に､パケットキャプチャなどで､パケットのヘッダーを偽造されることで､CoSの値が変更されるため優先度が変化する｡優先度が変化しているパケットによって､ルータやスイッチに対して必要でないパケットに対しても処理を優先的に行う必要があり負荷がかかるため必要だ｡
* ポリシング
  * 最低限保証している伝送速度を超過するとトラフィックを破棄することや優先度を変更することで回線の占有を防ぐ
* シェーピング
  * 伝送速度の設定値を超過するとルータやスイッチのバッファに保持し遅れて送信する
* PQ
  * 優先度が異なるパケットを4つに分けて領域を並べる
  * 優先度は､｢High｣､｢Medium｣､｢Normal｣､｢Low｣の4つの領域に分ける
  * 優先度の高いものから送信されるため､低い優先度は､高いものが送信し終えるまで送信されることはない
* WFQ
  * 優先度の領域ごとに重みを付けて送信するパケットの比率を変化するプロトコル
  * 自動的に領域を動的に制御する
  * 優先度は､TOS内の前半3ビットをもとに送信する
* CB-WFQ
  * 管理者が定義した領域を割り当て､最低帯域幅の指定によって送信するパケットの比率を変化するプロトコル
* LLQ
  * PQ + CB-WFQの組み合わせ
  * 最低帯域幅を保証しながら優先的なパケットを送信することが可能
* 輻輳の管理
  * RED
    * 領域がいっぱいになる前に､パケットをランダムに破棄するプロトコル
  * WRED
    * 領域がいっぱいになる前に､パケットの優先順位を考慮して破棄するプロトコル
---
## 2 SNMPのまとめ
* SNMPの背景
  * 複数のルータやスイッチを管理する際に､何らかの原因で故障によったものを､1つ1つ確認して見て回るのは手間がかかる｡
* SNMPの目的
  * ネットワーク上に接続されている機器の情報をサーバーで収集管理し､見ることができれば1つ1つ確認する必要がなくなる｡
  
* SNMP構成
  * SNMPマネージャ
    * 管理側のサーバー
    * SNMPエージェントに対してオブジェクト識別子を指定して情報を受信する
  * SNMPエージェント
    * 管理される側のルータやスイッチ
    * SNMPマネージャに対して指定されたOID
    * 機器の情報を送信する
    * UDPでの通信(Port 161,162)

  * MIB
    * 集めた情報をツリー構造のデータベースに保存する

  * 標準MIB
    * IETFが発行したRFCで規定されているMIB
  * 拡張MIB
    * ベンダーが独自に規定したMIB

> 簡易的な構築手順を以下に示す。<br>
>   ① SNMPビューを作成する｡<br>
>   ② SNMPグループを作成する｡<br>
>   ③ SNMPユーザの作成する｡<br>
>   ④ セキュリティレベルやパスワードを設定する<br>

## 2-1 SNMP実験内容
* 実験1<br>
    SNMPビューの確認
    ```
    show snmp view
    ```
  * 結果<br>

* 実験2<br>
    SNMPグループの確認
    ```
    show snmp group
    ```
  * 結果<br>

* 実験3<br>
    SNMPユーザの確認
    ```
    show snmp user
    ```
  * 結果<br>

---
## 3 参考文献･引用
[WatchGuard Help Center､｢VLAN インターフェイスの 802.1p マーキングについて｣､2022/09/09アクセス](https://www.watchguard.com/help/docs/help-center/ja-JP/Content/en-US/Fireware/networksetup/images/diagram_vlan_layer2_marking.jpg)