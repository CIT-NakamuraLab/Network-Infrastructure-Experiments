**活動実施日：2022年9月23日(実験未実施)**

# インフラ実験活動レポート(CCNA第15章相当の要点まとめ)

# *ワイヤレスLAN(無線LAN)とは*

LANケーブルや光ファイバケーブルといった有線ケーブルを使用せずに、電波を使用した通信技術のことである。  
ワイヤレスLANの特徴と概要を以下に記す。

* ## **利便性とモビリティの向上が可能**  
  機器同士をケーブルで結ぶ必要が無いので、電波の届く範囲内であれば自由に利用・通信することが可能であるが、壁などの遮蔽物により電波が届かないということも起こりうるため、電波の届く範囲を考慮したネットワークを構築する必要がある。

* ## **電波の干渉による通信への影響が懸念**
  同じ電波の周波数帯を使用する機器が近くにあると互いに干渉し、通信が不安定になったり通信速度が低下する可能性がある。また、ワイヤレスLANは**半二重通信**なので、同じ周波数帯で同時に電波を発信する端末があるとコリジョンが発生する。ワイヤレスLANでは**CSMA/CA方式**でコリジョンの発生を制御している。

* ## **セキュリティ実装の重要性**
  ワイヤレスLANでは電波を用いてデータを転送するため、電波の不正傍受による盗聴や不正接続の危険性を考慮し、認証の実装やデータの暗号化を重点的に行う必要がある。

* ## **電波によるデータの転送が可能**
  ワイヤレスLANでは主に2.4GHz帯と5GHz帯が利用されている。2.4GHz帯は他の機器も使用する周波数帯のため電波干渉が起こりやすいが、障害物を回り込んで伝わることができ、5GHz帯は他の機器では使用されていない周波数帯のため電波干渉が起こりづらいが、障害物の影響を受けやすいという特徴がある。
  
# *ワイヤレスLANの規格と種類*

| 規格 | 周波数帯域 | 最大伝送速度 | 策定時期 |
| :---: | :---: | :---: | :---: |
| IEEE802.11b | 2.4GHz | 11Mbps | 1999年 |
| IEEE802.11a | 5GHz | 54Mbps | 1999年 |
| IEEE802.11g | 2.4GHz | 54Mbps | 2003年 |
| IEEE802.11n | 2.4GHz/5GHz | 600Mbps | 2009年 |
| IEEE802.11ac | 5GHz | 6.9Gbps | 2013年 |
| IEEE802.11ax | 2.4GHz/5GHz | 9.6Gbps | 2020年 |

* ## **IEEE802.11b/g**
  **IEEE802.11b**と**IEEE802.11g**はどちらも2.4GHz帯の周波数を使用し、最大伝送速度はそれぞれ11Mbps、54Mbpsとなっている。  
  IEEE802.11bの1つのチャネル幅は22MHzで、電波干渉を起こさずに同時使用することができるチャネル数は最大で1・6・11・14chの4つである。  
  IEEE802.11gの1つのチャネル幅は20MHzで、電波干渉を起こさずに同時使用することができるチャネル数は最大で1・5・9・13chの4つだが、余裕を持たせて1・6・11chの3チャネルを割り当てることが一般的である。

* ## **IEEE802.11a**
  **IEEE802.11a**は5GHz帯の周波数を使用し、最大伝送速度は54Mbpsとなっている。使用可能なチャネルは全部で19個あり、それぞれのチャネルの周波数は重複していないため、電波の干渉を考慮せずに19チャネル全てを同時使用することが可能である。

* ## **IEEE802.11n/ac**
  **IEEE802.11n**は2.4GHz帯と5GHz帯の2つの周波数帯域を使用することができ、最大伝送速度は600Mbpsとなっている。また、**IEEE802.11ac**は5GHz帯の周波数帯域のみ使用可能で、最大6.9Gbpsの高速通信が可能となった。このような高速通信が実現できた背景には**MIMO**と**チャネルボンディング**などの技術がある。

  * ### **MIMO(Multiple Input Multiple Output)**
    送信と受信のアンテナを複数使用し、ストリームと呼ばれるデータの通信路を複数確立して通信を分散・同時送信することを可能とする技術である。

  * ### **チャネルボンディング**
    隣り合うチャネルを束ねることで使用する周波数の幅を広げ、高速通信を実現する技術である。

# *ワイヤレスLANの通信方式*

ワイヤレスLANの通信方式には、**アドホックモード**と**インフラストラクチャモード**の2つがある。

* **アドホックモード**  
  アクセスポイントを使用せずに、機器同士で直接接続を行うモードのこと。**IBSS(Independent Basic Service Set)モード**とも呼ばれる。

* **インフラストラクチャモード**  
  アクセスポイントを介することで通信を行うモードのことである。社内ネットワークではインフラストラクチャモードでの構成が一般的である。  

ここからはインフラストラクチャモードでの構成についてまとめていく。

* ## **アクセスポイント**  
  ワイヤレスLANクライアント同士の通信やワイヤレスLANから有線LANへの接続などを行っており、またワイヤレスLANクライアントがネットワークに繋がるまでに、アクセスポイントの識別名であるSSIDの確認や認証、接続の要求とその応答などのやり取りを行っている。  
  さらに、電波の不正傍受による盗聴などから通信データを守るための暗号化や復号もアクセスポイントで行っている。

* ## **BSS(Basic Service Set)とBSSID**  
  単一のアクセスポイントと、そのアクセスポイントの電波の届く範囲に存在するワイヤレスLANクライアント端末で構成されている範囲を指す。  
  BSSIDはBSSを識別するIDで48bitの値で構成されている。通常はMACアドレスと同じである。

* ## **ESS(Extended Service Set)とESSID**  
  複数のBSSで構成された範囲を指し、**ESSID**はESSを識別するIDで、アクセスポイントを識別するためにつけるIDのことである。また、アクセスポイントに設定する必要がある。  
  アクセスポイントに設定されているESSIDと同じSSIDを設定しているクライアント端末のみが通信をすることができる。

* ## **ローミング**  
  ワイヤレスLANクライアントの電波状況に応じて接続するアクセスポイントを自動的に切り替える機能のことである。ワイヤレスLANの位置によってアクセスポイントからの電波状況が変動し、通信速度が低下したり通信が不安定になったりするため、より強い電波が届くアクセスポイントに接続が自動的に切り替えられる。  
  同じESSIDが設定されているアクセスポイント間では、ワイヤレスLANクライアントが移動してもESSIDを変更することなく通信を継続することが可能となる。

* ## **ワイヤレスLANクライアントとアクセスポイント間の接続**  
  ワイヤレス通信では、**管理フレーム**、**制御フレーム**、**データフレーム**の3つのフレームを使用しているが、接続時には**管理フレーム**が用いられている。  
  アクセスポイントは**ビーコン**という信号を周囲に対して定期的に送信している。その信号を受け取ったワイヤレスLANクライアントはESSIDの情報を確認後、認証フェーズに移る。  
  ワイヤレスLANクライアントからアクセスポイントを探すことも可能で、その場合はワイヤレスLANクライアントから接続したいアクセスポイントの**プローブ要求**で送信する。アクセスポイントから**プローブ応答**が得られれば認証フェーズに移る。  
  認証フェーズに移った後、ワイヤレスLANクライアントとアクセスポイント間で互いに設定していた認証方式を用いて認証を行う。ワイヤレスLANクライアントから**認証要求**を送信し、アクセスポイントが**認証応答**で認証の可否を返す。  
  認証を行なった結果、アクセスポイントから正しいクライアントと判断されると、ワイヤレスLANクライアントから**アソシエーション要求**という接続要求を行う。アクセスポイントは接続の許可を**アソシエーション応答**で返答する。そうすると接続が確立する。

# *自立型アクセスポイントと集中管理型アクセスポイント*

* ## **自立型アクセスポイント**
  アクセスポイント上でIOSが動作し、設定を行うことでワイヤレスLANを構築することができる。  
  ネットワークを構成する際に数台程度アクセスポイントを導入する場合に適している。

* ## **集中管理型アクセスポイント**
  アクセスポイント自体に直接設定を行うのではなく、**ワイヤレスLANコントローラ**を介して一括で管理・設定を行う。  
  ワイヤレスコントローラを使用すると、ワイヤレスLANの運用やアクセスポイントの管理を簡易化することができ、多くのアクセスポイントが存在する中・大規模なネットワークにおいて設定・管理にかかる手間を大幅に抑えることができる。

# *スプリットMACアーキテクチャ*
ワイヤレスLANコントローラと集中管理型アクセスポイントを使用したワイヤレスLAN構成でIEEE802.11における処理分離する概念のことである。通信の**暗号化**などのリアルタイム性が高い処理はアクセスポイントで、**認証**などのリアルタイム性が低い処理はワイヤレスLANコントローラで行う。  
集中管理型のワイヤレスLANでは、すべてのデータトラフィックはワイヤレスLANコントローラとアクセスポイント間を経由して送信される。両機器間の通信には**CAPWAP**というプロトコルが使用される。

  ## **CAPWAP(Control And Provisioning of Wireless Access Points)**
ワイヤレスLANコントローラと**集中管理型アクセスポイント**間のやり取りで使用されるプロトコルである。  
CAPWAPトンネルでやり取りされる通信には**CAPWAP制御メッセージ**と**CAPWAPデータ**の2種類がある。

* **CAPWAP制御メッセージ**  
  ワイヤレスLANコントローラによるアクセスポイントの構成、操作、管理に使用される。

* **CAPWAPデータ**  
  ワイヤレスLANクライアントから送信されたデータを、アクセスポイントからワイヤレスLANコントローラへ転送する際に使用される。

## **FlexConnect**

通常はワイヤレスLANコントローラとの接続が失われると、CAPWAPトンネルも失われるため、アクセスポイントも動作が停止するが、アクセスポイントの動作モードを**FlexConnect**モードに設定しておくと、ワイヤレスLANコントローラの接続が失われた後も独立して動作を継続することが可能となる。

# *ワイヤレスLANにおけるセキュリティの必要性*

ワイヤレス通信は電波を使用してクライアント機器とアクセスポイントを接続するため、電波の範囲内に存在する機器であれば簡単に通信を受信できてしまう。そのためワイヤレスLANにおいてネットワークを保護するには以下に焦点を当てたセキュリティの実装を行う必要がある。

* ## **ワイヤレスデータの暗号化**  
  仮に、クライアント端末であるユーザPCのWebブラウザからパスワードを入力した通信が送信された場合、パスワードが格納されたデータが電波となってアクセスポイントを含む周囲へと送信されてしまう。  
  アクセスポイントとクライアント端末の間で共通する暗号化方式を使用することで、データをアクセスポイントだけが読み取れるようになり、安全に送信することができるようになる。

* ## **クライアント端末の認証**  
  悪意のあるユーザが正規のクライアント端末になりすまして接続してきた場合、アクセスポイントはその端末の接続を拒否しなければならないため、アクセスポイントは接続を試みるクライアントが正規のユーザであるがどうかを判断するために認証を行う。認証を行うことで、正規のユーザかどうかの識別を行うことができる。  
  ワイヤレスLANでは通常、パスフレーズによる**事前共有鍵認証**、もしくはRADIUSサーバを使用した**IEEE802.1X認証**を行う。

  * **事前共有鍵認証(Pre-shared key認証:PSK認証)**  
    アクセスポイントとクライアント端末全体で同じパスフレーズを事前に設定し、そのパスフレーズから暗号鍵(事前共有鍵)が生成され、これを利用して認証を行う。  
    認証サーバを使用しない手軽さから、個人や家庭向けの小規模な無線LAN、公共のワイヤレスネットワークで広く普及しているが、パスフレーズが流出する可能性があることから、セキュリティ強度としては高くない。

  * **IEEE802.1X認証**  
    →アクセスポイントがオーセンティケータとして動作してユーザIDやパスワードなどの使用してユーザIDの認証を行う。

# *ワイヤレスLANのセキュリティ規格*

ワイヤレスLANにおけるセキュリティ規格には次の4つがある。

* ## **WEP**  
  40bitまたは104bitの固定長の**WEPキー**という共通鍵を用いて認証と暗号化を行う。この規格は**RC4**という暗号化アルゴリズムを用いて暗号化を行なっているが、時間をかければ暗号鍵が解読できてしまうという脆弱性が発見されたため、現在ではほとんど使用されていない。

* ## **WPA**  
  WEPに脆弱性が発見されたため、新たなセキュリティ規格として策定された。  
  **TKIP(Temporal Key Integrity Protocol)** という暗号化方式を使用して堅牢なセキュリティを実現している。暗号化アルゴリズム自体はWEPと同じRC4を採用しているが、TKIPを使用して一定時間ごとに暗号鍵を変更するなどの処理を行い、解読を困難にさせている。  
  また、TKIPはデータ部分に**MIC(Message Integrity Code)** というフィールドを付加しており、メッセージの改ざんを検知できる。

* ## **WPA2**  
  WPAと動作がほとんど共通しているが、暗号化方式に**CCMP(Counter Mode-CBC MAC Protocol)** を採用し、**AES(Advanced Encryption Standard)** という暗号化アルゴリズムを採用することでより強度なセキュリティを実現している。CCMPでは　**CBC-MAC**という仕組みを使用してメッセージの改ざん検知を行なっており、現在の社内ワイヤレスLANにおいて最も普及しているセキュリティ規格である。

* ## **WPA3**  
  WPA2の脆弱性を突いた**KRACK攻撃**が発見され、その対策として発表された新規格である。  
  **SAE(Simultaneous Authentication of Equals)** という新しいハンドシェイクの手順を実装し、従来の4ウェイハンドシェイクの前にSAEハンドシェイクを行うことでKRACK攻撃を無効化する。  
  また、一定回数ログインに失敗するとブロックする機能が追加され、辞書攻撃にも対応するようになっている。